# ğŸ”‹ HÆ¯á»šNG DáºªN Sá»¬ Dá»¤NG CHá»¨C NÄ‚NG QUáº¢N LÃ Äá»”I PIN (STAFF)

## ğŸ“‹ Tá»•ng quan

Chá»©c nÄƒng "XÃ¡c nháº­n Ä‘á»•i pin" cho phÃ©p nhÃ¢n viÃªn tráº¡m (Staff) xá»­ lÃ½ cÃ¡c yÃªu cáº§u Ä‘á»•i pin tá»« tÃ i xáº¿ (Driver) theo quy trÃ¬nh chuáº©n.

## ğŸ”„ Quy trÃ¬nh Ä‘á»•i pin

### BÆ°á»›c 1: Tiáº¿p nháº­n yÃªu cáº§u Ä‘á»•i pin
- Há»‡ thá»‘ng hiá»ƒn thá»‹ danh sÃ¡ch yÃªu cáº§u Ä‘á»•i pin Ä‘ang chá» xá»­ lÃ½ (status: Pending)
- ThÃ´ng tin hiá»ƒn thá»‹:
  - MÃ£ yÃªu cáº§u
  - ThÃ´ng tin tÃ i xáº¿ (tÃªn, SÄT)
  - Biá»ƒn sá»‘ xe
  - Pin cÅ© (ID, SOC%)
  - GÃ³i Ä‘Äƒng kÃ½ (Basic/Premium)
  - Sá»‘ láº§n Ä‘á»•i trong thÃ¡ng
  - Thá»i gian yÃªu cáº§u

### BÆ°á»›c 2: XÃ¡c nháº­n Ä‘á»•i pin
1. Staff nháº¥n nÃºt "âœ… XÃ¡c nháº­n"
2. Modal hiá»ƒn thá»‹ danh sÃ¡ch pin sáºµn sÃ ng:
   - ID pin
   - SOC (State of Charge) - % pin cÃ²n láº¡i
   - SOH (State of Health) - % sá»©c khá»e pin
3. Staff chá»n pin má»›i Ä‘áº§y nÄƒng lÆ°á»£ng (SOC cao)
4. Há»‡ thá»‘ng tá»± Ä‘á»™ng:
   - Cáº­p nháº­t pin cÅ© â†’ tráº¡ng thÃ¡i "Charging"
   - Cáº­p nháº­t pin má»›i â†’ tráº¡ng thÃ¡i "In Use"
   - LÆ°u lá»‹ch sá»­ giao dá»‹ch vÃ o báº£ng Swaps

### BÆ°á»›c 3: Ghi nháº­n thanh toÃ¡n (náº¿u cáº§n)
**Äiá»u kiá»‡n:** TÃ i xáº¿ Ä‘Ã£ vÆ°á»£t quÃ£ng Ä‘Æ°á»ng (km) cá»§a gÃ³i Ä‘Äƒng kÃ½

**CÃ¡c gÃ³i Ä‘Äƒng kÃ½:**
- **Eco**: 200 km/thÃ¡ng
- **CÆ¡ báº£n (Basic)**: 400 km/thÃ¡ng
- **Plus**: 600 km/thÃ¡ng
- **Premium**: KhÃ´ng giá»›i háº¡n km

**TÃ­nh phÃ­ vÆ°á»£t gÃ³i:**
- GiÃ¡: 100 VNÄ/km vÆ°á»£t
- VÃ­ dá»¥: GÃ³i Basic (400km), Ä‘Ã£ cháº¡y 450km â†’ VÆ°á»£t 50km â†’ PhÃ­: 5,000 VNÄ

1. Modal thanh toÃ¡n hiá»ƒn thá»‹:
   - ThÃ´ng bÃ¡o vÆ°á»£t gÃ³i
   - Giá»›i háº¡n gÃ³i (km)
   - ÄÃ£ cháº¡y (km)
   - Sá»‘ km vÆ°á»£t
   - Sá»‘ tiá»n cáº§n thanh toÃ¡n (tá»± Ä‘á»™ng tÃ­nh = km vÆ°á»£t Ã— 100)
   - PhÆ°Æ¡ng thá»©c thanh toÃ¡n:
     - Tiá»n máº·t
     - Tháº»
     - VÃ­ Ä‘iá»‡n tá»­
     - Chuyá»ƒn khoáº£n

2. Staff xÃ¡c nháº­n sá»‘ tiá»n vÃ  phÆ°Æ¡ng thá»©c thanh toÃ¡n
3. Há»‡ thá»‘ng lÆ°u giao dá»‹ch vÃ o báº£ng Payments

### BÆ°á»›c 4: Kiá»ƒm tra pin cÅ©
1. Modal kiá»ƒm tra pin hiá»ƒn thá»‹
2. Staff nháº­p thÃ´ng tin:
   - **SOH (%)**: Äo sá»©c khá»e pin (0-100%)
   - **TÃ¬nh tráº¡ng váº­t lÃ½**:
     - Tá»‘t (Good)
     - KhÃ¡ (Fair)
     - KÃ©m (Poor)
     - HÆ° há»ng (Damaged)
   - **Ghi chÃº**: MÃ´ táº£ chi tiáº¿t tÃ¬nh tráº¡ng
   - **Cáº§n báº£o trÃ¬**: Checkbox náº¿u pin cáº§n sá»­a chá»¯a

3. Náº¿u chá»n "Cáº§n báº£o trÃ¬":
   - Pin tá»± Ä‘á»™ng chuyá»ƒn sang tráº¡ng thÃ¡i "Maintenance"
   - Pin khÃ´ng thá»ƒ sá»­ dá»¥ng cho Ä‘áº¿n khi Ä‘Æ°á»£c sá»­a

4. Há»‡ thá»‘ng lÆ°u vÃ o báº£ng Battery_History

### BÆ°á»›c 5: HoÃ n táº¥t
1. Staff nháº¥n "âœ… HoÃ n táº¥t Ä‘á»•i pin"
2. Há»‡ thá»‘ng tá»± Ä‘á»™ng:
   - Cáº­p nháº­t tráº¡ng thÃ¡i yÃªu cáº§u â†’ "Completed"
   - Cáº­p nháº­t bÃ¡o cÃ¡o tráº¡m (Reports):
     - TÄƒng sá»‘ láº§n Ä‘á»•i pin
     - Cá»™ng doanh thu (náº¿u cÃ³ thanh toÃ¡n)
   - Gá»­i thÃ´ng bÃ¡o thÃ nh cÃ´ng

## ğŸ“Š Thá»‘ng kÃª hiá»ƒn thá»‹

Dashboard hiá»ƒn thá»‹ 3 chá»‰ sá»‘ chÃ­nh:
1. **YÃªu cáº§u chá» xá»­ lÃ½**: Sá»‘ yÃªu cáº§u Pending
2. **Pin sáºµn sÃ ng**: Sá»‘ pin Available
3. **ÄÃ£ hoÃ n thÃ nh**: Sá»‘ yÃªu cáº§u Completed hÃ´m nay

## ğŸ¨ MÃ u sáº¯c & Tráº¡ng thÃ¡i

### Tráº¡ng thÃ¡i yÃªu cáº§u:
- ğŸŸ¡ **Pending**: Chá» xá»­ lÃ½ (mÃ u cam)
- ğŸ”µ **Processing**: Äang xá»­ lÃ½ (mÃ u xanh dÆ°Æ¡ng)
- ğŸŸ¢ **Completed**: HoÃ n thÃ nh (mÃ u xanh lÃ¡)
- ğŸ”´ **Rejected**: Tá»« chá»‘i (mÃ u Ä‘á»)

### MÃ u SOC (pin cÅ©):
- ğŸ”´ < 10%: Äá» (nguy hiá»ƒm)
- ğŸŸ  10-20%: Cam (cáº£nh bÃ¡o)
- ğŸŸ¢ > 20%: Xanh (bÃ¬nh thÆ°á»ng)

### Cáº£nh bÃ¡o vÆ°á»£t gÃ³i:
- âš ï¸ MÃ u Ä‘á» náº¿u sá»‘ láº§n Ä‘á»•i >= giá»›i háº¡n

## ğŸ“ Cáº¥u trÃºc File

```
SWP391/src/
â”œâ”€â”€ pages/Staff/
â”‚   â””â”€â”€ SwapConfirm.jsx          # Component chÃ­nh
â”œâ”€â”€ services/
â”‚   â””â”€â”€ swapService.js           # API service
â””â”€â”€ store/
    â””â”€â”€ swapSlice.js             # State management (Zustand)
```

## ğŸ”§ CÃ¡c chá»©c nÄƒng chÃ­nh

### SwapConfirm.jsx
- Hiá»ƒn thá»‹ danh sÃ¡ch yÃªu cáº§u
- Modal chá»n pin má»›i
- Modal thanh toÃ¡n
- Modal kiá»ƒm tra pin cÅ©
- Xá»­ lÃ½ workflow Ä‘áº§y Ä‘á»§

### swapService.js
- `getSwapRequests()`: Láº¥y danh sÃ¡ch yÃªu cáº§u
- `getSwapRequestById()`: Láº¥y chi tiáº¿t yÃªu cáº§u
- `createSwapRequest()`: Táº¡o yÃªu cáº§u má»›i
- `confirmSwap()`: XÃ¡c nháº­n chá»n pin
- `recordPayment()`: Ghi nháº­n thanh toÃ¡n
- `checkOldBattery()`: Kiá»ƒm tra pin cÅ©
- `completeSwap()`: HoÃ n táº¥t Ä‘á»•i pin
- `rejectSwapRequest()`: Tá»« chá»‘i yÃªu cáº§u
- `getSwapHistory()`: Lá»‹ch sá»­ Ä‘á»•i pin
- `getSwapStats()`: Thá»‘ng kÃª

### swapSlice.js (Zustand Store)
- State: `swapRequests`, `swapHistory`, `swapStats`, `selectedRequest`
- Actions: TÆ°Æ¡ng á»©ng vá»›i cÃ¡c API calls
- Helper functions: `getPendingRequests()`, `getCompletedRequests()`, etc.

## ğŸš€ CÃ¡ch sá»­ dá»¥ng

### 1. Truy cáº­p trang
```
Staff Dashboard â†’ Click vÃ o card "âœ… XÃ¡c nháº­n Ä‘á»•i pin"
```

### 2. Xá»­ lÃ½ yÃªu cáº§u
```
1. Xem danh sÃ¡ch yÃªu cáº§u Pending
2. Click "âœ… XÃ¡c nháº­n" trÃªn yÃªu cáº§u cáº§n xá»­ lÃ½
3. Chá»n pin má»›i tá»« danh sÃ¡ch
4. Náº¿u vÆ°á»£t gÃ³i â†’ Nháº­p thÃ´ng tin thanh toÃ¡n
5. Kiá»ƒm tra vÃ  nháº­p thÃ´ng tin pin cÅ©
6. Click "âœ… HoÃ n táº¥t Ä‘á»•i pin"
```

### 3. Tá»« chá»‘i yÃªu cáº§u
```
1. Click "âŒ Tá»« chá»‘i" trÃªn yÃªu cáº§u
2. XÃ¡c nháº­n tá»« chá»‘i
```

## ğŸ’¡ LÆ°u Ã½

1. **Pin sáºµn sÃ ng**: Chá»‰ hiá»ƒn thá»‹ pin cÃ³ tráº¡ng thÃ¡i "Available"
2. **Thanh toÃ¡n**: 
   - Chá»‰ yÃªu cáº§u khi tÃ i xáº¿ vÆ°á»£t quÃ£ng Ä‘Æ°á»ng (km) cá»§a gÃ³i
   - GÃ³i Premium khÃ´ng bao giá» pháº£i tráº£ thÃªm (khÃ´ng giá»›i háº¡n km)
   - GiÃ¡: 100 VNÄ/km vÆ°á»£t
3. **Kiá»ƒm tra pin**: Báº¯t buá»™c nháº­p SOH trÆ°á»›c khi hoÃ n táº¥t
4. **Báº£o trÃ¬**: Pin Ä‘Ã¡nh dáº¥u "Cáº§n báº£o trÃ¬" sáº½ khÃ´ng thá»ƒ sá»­ dá»¥ng
5. **ThÃ´ng bÃ¡o**: Hiá»ƒn thá»‹ 3 giÃ¢y sau má»—i thao tÃ¡c

## ğŸ¯ Mock Data

Hiá»‡n táº¡i sá»­ dá»¥ng mock data Ä‘á»ƒ demo:

**3 yÃªu cáº§u Ä‘á»•i pin máº«u:**
1. **SWP001** - Nguyá»…n VÄƒn A (Premium, 850km, khÃ´ng giá»›i háº¡n) âœ… KhÃ´ng cáº§n tráº£ thÃªm
2. **SWP002** - Tráº§n Thá»‹ B (Basic, 380/400km) âœ… ChÆ°a vÆ°á»£t gÃ³i
3. **SWP003** - LÃª VÄƒn C (Basic, 450/400km) âš ï¸ VÆ°á»£t 50km â†’ PhÃ­: 5,000 VNÄ

**5 pin sáºµn sÃ ng:**
- BAT-101 Ä‘áº¿n BAT-105 vá»›i SOC 95-100%, SOH 92-98%

**Delay:** 300-800ms Ä‘á»ƒ giáº£ láº­p API call

## ğŸ”œ TÃ­ch há»£p Backend

Khi tÃ­ch há»£p backend thá»±c, cáº§n:
1. Thay tháº¿ mock data báº±ng API calls thá»±c
2. Cáº­p nháº­t endpoint URLs
3. Xá»­ lÃ½ authentication/authorization
4. ThÃªm error handling chi tiáº¿t
5. Implement real-time updates (WebSocket)

## ğŸ“ Há»— trá»£

Náº¿u cÃ³ váº¥n Ä‘á», liÃªn há»‡ team phÃ¡t triá»ƒn.

---

**Version**: 1.0.0  
**Last Updated**: 2024-10-05  
**Author**: Development Team
